<app-loader></app-loader>
<div class="container-fluid breadcrumbBox py-2">
  <div class="row align-items-center">
    <div class="col-md-6">
      <h3>Grievance Report</h3>
    </div>
    <div class="col-md-6 d-flex justify-content-end">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item active" aria-current="page">Grievance Report</li>
        </ol>
      </nav>
    </div>
  </div>
</div>


<div class="row">
  <div class="col-md-12">
    <div class="card mb-0">
      <div class="card-header">
        <b><i class="bi bi-table"></i> Search Grievance</b>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-lg-3 col-md-3 col-sm-6 col-12 mb-3">
            <label for="dtfromSubmittedDate" class="form-label">From Date:</label>
            <input type="date" id="dtfromSubmittedDate" name="dtfromSubmittedDate" class="form-control" [(ngModel)]="request.FromDate" onkeypress="return false;" />
          </div>
          <div class="col-lg-3 col-md-3 col-sm-6 col-12 mb-3">
            <label for="dttoSubmittedDate" class="form-label">To Date:</label>
            <input type="date" id="dttoSubmittedDate" name="dttoSubmittedDate" class="form-control" [(ngModel)]="request.ToDate" onkeypress="return false;" />
          </div>
          <div class="col-lg-3 col-md-3 col-sm-6 col-12 mb-3">
            <label for="ddlDepartmentID" class="form-label">Department</label>
            <select class="form-control" id="ddlDepartmentID" name="ddlDepartmentID" [(ngModel)]="request.DepartmentID"
                    #SeletedDepartmentID (change)="ddlDepartment_textChange(SeletedDepartmentID.value)">
              <option value="0" selected>--Select--</option>
              <option *ngFor="let item of DepartmentList" value="{{item.DepartmentID}}">{{item.DepartmentName}}</option>
            </select>
            <!--<div *ngIf="isSubmitted&&form.ddlDepartmentID.errors" class="text-danger">
              <p *ngIf="!form.ddlDepartmentID.errors.DropdownValidators"><i aria-hidden="true"></i>This field is required .!</p>
            </div>-->
          </div>

          <div class="col-lg-3 col-md-3 col-sm-6 col-12 mb-3">
            <label for="ddlCollegeID" class="form-label">College</label>
            <select class="form-control" id="ddlCollegeID" name="ddlCollegeID" [(ngModel)]="request.CollegeID">
              <option value="0" selected>--Select--</option>
              <option *ngFor="let item of CollegeDataList" value="{{item.CollegeID}}">{{item.CollegeName}}</option>
            </select>
          </div>

        </div>
      </div>
      <div class="card-footer text-end">
        <button type="submit" (click)="GetGrievanceReportList(request.FromDate,request.ToDate, request.DepartmentID, request.CollegeID)" class="btn btn-primary"><i class="fa fa-search"></i>&nbsp;Search</button>
        <!--<button type="submit" (click)="ResetControl()" class="btn btn-danger"><i class="bi bi-bootstrap-reboot"></i>&nbsp;Reset</button>-->
        <button type="submit" (click)="btnExportTable_Click()" class="btn btn-success"><i class="fa fa-file-excel-o"></i> &nbsp;Export Record</button>
      </div>
    </div>
  </div>
</div>

<!--<div class="d-flex align-items-center table-filter mr-15">
  <i class="fa fa-search"></i>
  <input type="text" class="form-control" placeholder="Search Here" [(ngModel)]="searchText" />
</div>-->
<div class="card mb-0">
  <div class="card-header d-xxl-flex d-xl-flex d-md-flex d-sm-block justify-content-between align-items-center">
    <b><i class="bi bi-table"></i> Grievance List </b>
    <div class="d-flex align-items-center">
      <div class="btn-group mr-15" role="group" aria-label="Basic outlined example">
        <button type="button" class="btn btn-outline-primary" title="Copy" id="btnCopyTable" (click)="btnCopyTable_Click()"><i class="fa fa-copy"></i></button>
        <button type="button" class="btn btn-outline-primary" title="Excel" id="btnExportTable" (click)="btnExportTable_Click()"><i class="fa fa-file-excel-o"></i></button>
      </div>
      <div class="d-flex align-items-center table-filter mr-15">
        <i class="fa fa-search"></i>
        <input type="text" class="form-control" placeholder="Search Here" [(ngModel)]="searchText" />
      </div>
    </div>
  </div>

  <div class="card-body">
    <div class="table-responsive">
      <!--<div class="row">-->
      <table class="table table-hover table-striped-columns" #content id="tabellist">
        <thead>
          <tr>
            <th>Sr. No</th>
            <th>Grievance No</th>
            <th>Date</th>
            <th>Bug From</th>
            <th>Department Name</th>
            <th>College Name</th>
            <th>Mobile No.</th>
            <th>Subject</th>
            <th>Description</th>
            <th>Grievance Status</th>
            <th>Grievance Remark</th>
            <th>Attachment File</th>
            <th>Attachment Image</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let row of GrievanceReportData | tableSearchFilter:searchText; let idx=index;">

            <td>{{idx+1}}</td>
            <td>{{row.GrievanceNo}}</td>
            <td>{{row.Date}}</td>
            <td>{{row.BugFrom}}</td>
            <td>{{row.DepartmentName}}</td>
            <td>{{row.CollegeName}}</td>
            <td>{{row.MobileNo}}</td>
            <td>{{row.Subject}}</td>
            <td>{{row.Description}}</td>
            <td>{{row.GrievanceStatus}}</td>
            <td>{{row.GrievanceRemark}}</td>
            <td><a target="_blank" href="{{row.AttachmentFile}}"><i class="fa fa-eye"></i></a></td>
            <td><a target="_blank" href="{{row.AttachmentImage}}" *ngIf="row.AttachmentImage!=''"><i class="fa fa-eye"></i></a></td>
            <td>
              <a href="javascript:void(0)" (click)="ReceivedGrievancePopUP(mymodalReceivedGrievance,row.GrievanceID,row.DepartmentID,row.CollegeID,row.DepartmentName,row.CollegeName)" class="btn btn-sm btn-info" *ngIf="row.GrievanceStatus=='Pending' || row.GrievanceStatus=='Reopen'">Dispose</a>
              <a href="javascript:void(0)" (click)="GrievanceTrailPopUP(mymodalTrailGrievance,row.GrievanceID)" class="btn btn-sm btn-primary">Trail</a>
            </td>
          </tr>

        </tbody>
      </table>
      <!--</div>-->
    </div>
  </div>
</div>
<ng-template #mymodalReceivedGrievance let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title" style="font-size: 17px; font-weight: 600 !important;">Received Grievance</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <i class="fa fa-close"></i>
    </button>
  </div>
  <div class="modal-body">
    <div class="dprt-mange py-3">
      <p><strong>Department Name:</strong> ({{SelectedDepartmentName}})</p>
      <p> <strong>College Name:  </strong>({{SelectedCollegeName}})</p>
    </div>
    <div class="row">
      <div class="col-lg-12 col-md-12 mb-3">
        <label for="txtGrievanceRemark" maxlength="200" class="form-label">Enter Grievance Remark!:<span style="color:red;">*</span></label>
        <!--<input type="text" class="form-control" id="txtGrievanceRemark" name="txtGrievanceRemark" [(ngModel)]="EnterGrievanceRemark">-->
        <textarea type="text" id="txtGrievanceRemark" name="txtGrievanceRemark" class="form-control" [(ngModel)]="requestgrievancere.GrievanceRemark"></textarea>
        <div *ngIf="requestgrievancere.GrievanceRemark == null || requestgrievancere.GrievanceRemark == '' || requestgrievancere.GrievanceRemark == undefined" class="text-danger">
          <p><i aria-hidden="true"></i>This field is required .!</p>
        </div>
      </div>
      <div class="col-lg-12 col-md-12 mb-3">
        <label class="form-label">Attach File</label>
        <div class="d-flex">
          <input type="file" style="display:none;" class="form-control" id="fileAttachmentImage" name="fileAttachmentImage" (change)="onFilechange($event)" formControlName="fileAttachmentImage">
          <label class="btn upload" for="fileAttachmentImage">
            <span class="filename">Choose file</span>
            {{requestgrievancere.AttachmentImage === '' ? 'No File Choosen' : requestgrievancere.AttachmentImage_Dis_FileName}}
          </label>
          <div class="btn-group" *ngIf="requestgrievancere.AttachmentImage != ''">
            <a class="btn btn-outline-primary" target="_blank" href="{{requestgrievancere.AttachmentImagePath}}"><i class="fa fa-eye"></i></a>
            <button type="button" class="btn btn-outline-danger" (click)="DeleteImage(requestgrievancere.AttachmentImagePath)"><i class="fa fa-trash-o"></i></button>
          </div>
        </div>
      </div>
      <div class=" col-md-12 text-center mb-4">
        <button type="button" class="btn btn-primary pull-right" (click)="SubmitGrievanceStatus()">Submit</button>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #mymodalTrailGrievance let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title" style="font-size: 17px; font-weight: 600 !important;">Trail</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <i class="fa fa-close"></i>
    </button>
  </div>
  <div class="modal-body">
    <div class="table-responsive">
      <!--<div class="row">-->
      <table class="table table-hover table-striped-columns" #content id="tabellist1">
        <thead>
          <tr>
            <th>Sr. No</th>
            <th>Grievance No</th>
            <th>Date</th>
            <th>Mobile No.</th>
            <th>Grievance Status</th>
            <th>Grievance Remark</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let row of GrievanceTrailData | tableSearchFilter:searchText; let idx=index;">

            <td>{{idx+1}}</td>
            <td>{{row.GrievanceNo}}</td>
            <td>{{row.Date}}</td>
            <td>{{row.MobileNo}}</td>
            <td>{{row.GrievanceStatus}}</td>
            <td>{{row.GrievanceRemark}}</td>
          </tr>

        </tbody>
      </table>
      <!--</div>-->
    </div>
  </div>
</ng-template>
